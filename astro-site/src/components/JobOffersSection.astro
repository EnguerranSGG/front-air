---
let jobOffers = [];

try {
  const res = await fetch(import.meta.env.PUBLIC_API_URL + '/jobOffers/all');
  const data = await res.json();
  jobOffers = Array.isArray(data) ? data : [];
} catch (err) {
  console.error('Erreur lors du fetch des offres :', err);
}
---
<section class="offers-section">
  <h2>Nos offres d'emplois</h2>
  <p class="offers-subtitle">Rejoignez notre équipe et participez à notre mission sociale</p>

  <div class="offers-list">
    {jobOffers.map((offer, index) => (
      <div class="offer-card" key={offer.job_offer_id}>
        <img
          src={`${import.meta.env.PUBLIC_ASSET_URL}/files/${offer.file_id}/download`}
          alt={offer.name}
        />
        <div class="offer-content">
          <h3 class="offer-name">{offer.name}</h3>
          <p class="offer-type">{offer.job_type}{offer.city ? ` - ${offer.city}` : ''}</p>

          <div class="description-wrapper" id={`desc-${index}`}>
            <p class="offer-description">{offer.description}</p>
          </div>

          <div class="buttons">
            <!-- Bouton de toggling pour mobile uniquement -->
            <button
              type="button"
              class="toggle-button"
              onclick={`(() => {
  const wrapper = document.getElementById('desc-${index}');
  const isOpen = wrapper.classList.toggle('show');
  this.textContent = isOpen ? 'Voir moins' : 'Voir plus';
})()`}
            >
              Voir plus
            </button>

            <!-- Bouton toujours visible -->
            <button type="button" class="apply-button">
              Candidater
            </button>
          </div>
        </div>
      </div>
    ))}
  </div>
</section>
