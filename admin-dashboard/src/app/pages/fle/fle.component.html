<div class="fle-page">
  <div class="page-header">
    <h1>Gestion du FLE</h1>
    <p>Gérez les images et titres de la section FLE</p>
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Chargement des éléments FLE...</p>
  </div>

  <!-- Grid des éléments FLE -->
  <div *ngIf="!isLoading" class="fle-grid">
    <div 
      *ngFor="let item of fleItems" 
      class="fle-item"
      [class.has-image]="item.imageUrl"
    >
      <div class="item-header">
        <h3 class="item-title">{{ item.title }}</h3>
        <p class="item-description">{{ item.description }}</p>
      </div>

      <div class="item-image-container">
        <img 
          *ngIf="item.imageUrl && !isPdfFile(item)" 
          [src]="item.imageUrl" 
          [alt]="item.title"
          class="item-image"
          (error)="refreshImage(item)"
        />
        <div *ngIf="item.imageUrl && isPdfFile(item)" class="pdf-container">
          <svg width="64" height="64" fill="currentColor" viewBox="0 0 24 24" class="pdf-icon">
            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
          </svg>
          <span class="pdf-label">Document PDF</span>
          <a [href]="item.imageUrl" target="_blank" class="download-link">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
              <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
            </svg>
            Télécharger
          </a>
        </div>
        <div *ngIf="!item.imageUrl" class="no-image">
          <svg width="48" height="48" fill="currentColor" viewBox="0 0 24 24">
            <path d="M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19C20.1,21 21,20.1 21,19M8.5,13.5L11,16.5L14.5,12L19,18H5L8.5,13.5Z"/>
          </svg>
          <span>Aucune image</span>
        </div>
      </div>

      <div class="item-actions">
        <button (click)="openModal(item)" class="edit-button">
          <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
          Modifier
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de modification -->
  <div class="modal-overlay" *ngIf="isModalOpen">
    <div class="modal">
      <div class="modal-header">
        <h3>
          <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24" class="title-icon">
            <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z"/>
          </svg>
          Modifier {{ selectedItem?.title }}
        </h3>
        <button (click)="closeModal()" class="close-button">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
          </svg>
        </button>
      </div>

      <form [formGroup]="updateForm" (ngSubmit)="updateFleItem()">
        <div class="form-group">
          <label for="title">Titre</label>
          <input 
            id="title"
            formControlName="title" 
            type="text" 
            placeholder="Titre de l'élément" 
            class="modern-input" 
          />
        </div>

        <div class="file-upload-section">
          <label class="file-upload-button">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
              <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
            </svg>
            <span>Sélectionner un nouveau fichier (optionnel)</span>
            <input type="file" (change)="onFileSelected($event)" [accept]="getFileAcceptType()" />
          </label>

          <div *ngIf="selectedFile" class="file-selected-info">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" class="success-icon">
              <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M11,16.5L18,9.5L16.59,8.09L11,13.67L7.91,10.59L6.5,12L11,16.5Z"/>
            </svg>
            <span><strong>{{ selectedFile.name | sanitize }}</strong></span>
          </div>
        </div>

        <div class="form-buttons">
          <button type="submit" class="save-button">
            <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
              <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/>
            </svg>
            Sauvegarder
          </button>
          <button type="button" (click)="closeModal()" class="cancel-button">
            <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
            Annuler
          </button>
        </div>
      </form>
    </div>
  </div>
</div> 