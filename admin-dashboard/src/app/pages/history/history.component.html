<h2>Historique</h2>

<!-- Section de gestion de la présentation d'historique -->
<div class="presentation-section">
  <div class="presentation-card">
    <h3>Présentation de l'historique</h3>
    
    <div *ngIf="isLoadingPresentation" class="loading">
      <div class="spinner"></div>
      <p>Chargement de la présentation...</p>
    </div>
    
    <div *ngIf="!isLoadingPresentation && presentation" class="presentation-content">
      <p class="presentation-text">{{ presentation.presentation_text }}</p>
    </div>
    
    <div *ngIf="!isLoadingPresentation && !presentation" class="error">
      <p>Aucune présentation trouvée</p>
    </div>
    
    <a routerLink="/presentation/edit/2" class="btn btn-primary">
      Modifier la présentation
    </a>
  </div>
</div>

<div class="filter-add-wrapper">
  <button class="add-button" (click)="startCreate()" *ngIf="!isCreating && !editingTimeId">
    <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
      <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
    </svg>
    Ajouter un événement
  </button>
</div>

<!-- Formulaire de création modernisé -->
<div class="create-form" *ngIf="isCreating">
  <h3>
    <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24" class="title-icon">
      <path d="M20,6C20.58,6 21.05,6.2 21.42,6.59C21.8,7 22,7.45 22,8V19C22,19.55 21.8,20 21.42,20.41C21.05,20.8 20.58,21 20,21H4C3.42,21 2.95,20.8 2.58,20.41C2.2,20 2,19.55 2,19V8C2,7.45 2.2,7 2.58,6.59C2.95,6.2 3.42,6 4,6H8V4C8,3.42 8.2,2.95 8.58,2.58C8.95,2.2 9.42,2 10,2H14C14.58,2 15.05,2.2 15.42,2.58C15.8,2.95 16,3.42 16,4V6H20M14,6V4H10V6H14Z"/>
    </svg>
    Nouvel événement historique
  </h3>
  <form [formGroup]="createForm" (ngSubmit)="addTime()">
    <div class="form-group">
      <input type="number" formControlName="year" placeholder="Année" class="modern-input" />
      <div *ngIf="createForm.get('year')?.touched && createForm.get('year')?.invalid" class="error">
        <span *ngIf="createForm.get('year')?.errors?.['required']">L'année est requise.</span>
        <span *ngIf="createForm.get('year')?.errors?.['min']">L'année doit être supérieure ou égale à 1900.</span>
        <span *ngIf="createForm.get('year')?.errors?.['max']">L'année ne peut pas dépasser 2200.</span>
      </div>
    </div>

    <div class="form-group">
      <input type="text" formControlName="event_description" placeholder="Description de l'événement" class="modern-input" />
      <div *ngIf="createForm.get('event_description')?.touched && createForm.get('event_description')?.invalid" class="error">
        <span *ngIf="createForm.get('event_description')?.errors?.['required']">La description est requise.</span>
        <span *ngIf="createForm.get('event_description')?.errors?.['maxlength']">175 caractères max.</span>
      </div>
    </div>

    <div class="form-buttons">
      <button type="submit" [disabled]="createForm.invalid" class="save-button">
        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
          <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/>
        </svg>
        Ajouter
      </button>
      <button type="button" (click)="cancelCreate()" class="cancel-button">
        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
          <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
        </svg>
        Annuler
      </button>
    </div>
  </form>
</div>

<!-- Liste des événements modernisée -->
<div *ngFor="let time of times" class="event-card">
  <!-- Affichage normal -->
  <ng-container *ngIf="editingTimeId !== time.time_id; else editTemplate">
    <div class="event-display">
      <div class="event-content">
        <strong class="event-year">{{ time.year }}</strong>
        <p class="event-description">{{ time.event_description | sanitize }}</p>

        <div class="offer-details">
          <div class="detail-item">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" class="detail-icon">
              <path d="M19,3H18V1H16V3H8V1H6V3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V8H19V19Z"/>
            </svg>
            <span>Événement historique</span>
          </div>
        </div>
      </div>

      <div class="event-buttons">
        <button (click)="startEdit(time)" class="edit-button">
          <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
          Modifier
        </button>
        <button (click)="deleteTime(time.time_id)" class="delete-button">
          <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
            <path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"/>
          </svg>
          Supprimer
        </button>
      </div>
    </div>
  </ng-container>

  <!-- Formulaire d'édition modernisé -->
  <ng-template #editTemplate>
    <div class="edit-form">
      <h4>
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24" class="title-icon">
          <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
        </svg>
        Modifier l'événement
      </h4>
      <form [formGroup]="editForm" (ngSubmit)="saveEdit(time)">
        <div class="form-group">
          <input type="number" formControlName="year" placeholder="Année" class="modern-input" />
          <div *ngIf="editForm.get('year')?.touched && editForm.get('year')?.invalid" class="error">
            <span *ngIf="editForm.get('year')?.errors?.['required']">L'année est requise.</span>
            <span *ngIf="editForm.get('year')?.errors?.['min']">L'année doit être supérieure ou égale à 1900.</span>
            <span *ngIf="editForm.get('year')?.errors?.['max']">L'année ne peut pas dépasser 2200.</span>
          </div>
        </div>

        <div class="form-group">
          <input type="text" formControlName="event_description" placeholder="Description de l'événement" class="modern-input" />
          <div *ngIf="editForm.get('event_description')?.touched && editForm.get('event_description')?.invalid" class="error">
            <span *ngIf="editForm.get('event_description')?.errors?.['required']">La description est requise.</span>
            <span *ngIf="editForm.get('event_description')?.errors?.['maxlength']">175 caractères max.</span>
          </div>
        </div>

        <div class="form-buttons">
          <button type="submit" [disabled]="editForm.invalid" class="save-button">
            <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
              <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/>
            </svg>
            Sauvegarder
          </button>
          <button type="button" (click)="cancelEdit()" class="cancel-button">
            <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
            Annuler
          </button>
        </div>
      </form>
    </div>
  </ng-template>
</div>
