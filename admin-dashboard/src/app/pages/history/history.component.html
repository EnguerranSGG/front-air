<h2>Historique</h2>

<div class="add-button-wrapper" *ngIf="!isCreating && !editingTimeId">
  <button class="secondary-button" (click)="startCreate()">➕ Ajouter un événement</button>
</div>

<!-- Formulaire de création -->
<form class="create-form" *ngIf="isCreating" [formGroup]="createForm" (ngSubmit)="addTime()">
  <input type="number" formControlName="year" placeholder="Année" />
  <div *ngIf="createForm.get('year')?.touched && createForm.get('year')?.invalid" class="error">
    <div *ngIf="createForm.get('year')?.errors?.['required']">L'année est requise.</div>
    <div *ngIf="createForm.get('year')?.errors?.['min']">L'année doit être supérieure ou égale à 1900.</div>
    <div *ngIf="createForm.get('year')?.errors?.['max']">L'année ne peut pas dépasser 2200.</div>
  </div>

  <input type="text" formControlName="event_description" placeholder="Description de l'événement" />
  <div *ngIf="createForm.get('event_description')?.touched && createForm.get('event_description')?.invalid" class="error">
    <div *ngIf="createForm.get('event_description')?.errors?.['required']">La description est requise.</div>
    <div *ngIf="createForm.get('event_description')?.errors?.['maxlength']">175 caractères max.</div>
  </div>

  <div class="form-buttons">
    <button class="secondary-button" type="submit" [disabled]="createForm.invalid">Ajouter</button>
    <button class="secondary-button" type="button" (click)="cancelCreate()">Annuler</button>
  </div>
</form>

<!-- Liste des événements -->
<div *ngFor="let time of times" class="event-card">
  <!-- Affichage normal -->
  <div *ngIf="editingTimeId !== time.time_id">
    <div class="event-content">
      <strong class="event-year">{{ time.year }}</strong>
      <p class="event-description">{{ time.event_description | sanitize }}</p>
    </div>
    <div class="event-buttons">
      <button class="secondary-button" (click)="startEdit(time)">✏️ Modifier</button>
      <button class="secondary-button" (click)="deleteTime(time.time_id)">🗑️ Supprimer</button>
    </div>
  </div>

  <!-- Formulaire d’édition -->
  <form *ngIf="editingTimeId === time.time_id" [formGroup]="editForm" (ngSubmit)="saveEdit(time)">
    <input type="number" formControlName="year" />
    <div *ngIf="editForm.get('year')?.touched && editForm.get('year')?.invalid" class="error">
      <div *ngIf="editForm.get('year')?.errors?.['required']">L'année est requise.</div>
      <div *ngIf="editForm.get('year')?.errors?.['min']">L'année doit être supérieure ou égale à 1900.</div>
      <div *ngIf="editForm.get('year')?.errors?.['max']">L'année ne peut pas dépasser 2200.</div>
    </div>

    <input type="text" formControlName="event_description" />
    <div *ngIf="editForm.get('event_description')?.touched && editForm.get('event_description')?.invalid" class="error">
      <div *ngIf="editForm.get('event_description')?.errors?.['required']">La description est requise.</div>
      <div *ngIf="editForm.get('event_description')?.errors?.['maxlength']">175 caractères max.</div>
    </div>

    <div class="form-buttons">
      <button type="submit" [disabled]="editForm.invalid">Valider</button>
      <button type="button" (click)="cancelEdit()">Annuler</button>
    </div>
  </form>
</div>
