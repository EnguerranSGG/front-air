<h2>🎯 Gestion des valeurs</h2>

<!-- Bouton d’ajout -->
<div class="filter-add-wrapper">
  <button (click)="showForm = !showForm">
    {{ showForm ? '❌ Annuler' : '➕ Ajouter une valeur' }}
  </button>
</div>

<!-- Formulaire de création -->
<form *ngIf="showForm" class="create-form" [formGroup]="createForm" (ngSubmit)="addValue()">
  <!-- Titre -->
  <input type="text" formControlName="name" placeholder="Titre" />
  <div *ngIf="createForm.get('name')?.invalid && createForm.get('name')?.touched" class="error">
    <span *ngIf="createForm.get('name')?.errors?.['required']">Le titre est obligatoire.</span>
    <span *ngIf="createForm.get('name')?.errors?.['maxlength']">Le titre ne doit pas dépasser 20 caractères.</span>
  </div>

  <!-- Fichier -->
  <div class="form-buttons">
    <button type="button" (click)="showCreateFileSelector = !showCreateFileSelector">
      {{ showCreateFileSelector ? '❌ Fermer les images' : '📎 Lier une image' }}
    </button>

    <div *ngIf="showCreateFileSelector">
      <app-file-selector
        [files]="files"
        [selectedFileId]="createForm.value.file_id"
        (fileSelected)="onFileSelect($event)">
      </app-file-selector>
    </div>

    <button type="submit" [disabled]="createForm.invalid">Créer</button>
  </div>
</form>


<!-- Liste des valeurs -->
<div *ngFor="let value of values" class="event-card">
  <!-- Affichage classique -->
  <ng-container *ngIf="editingValueId !== value.value_id; else editTemplate">
    <div class="event-content">
      <strong class="event-year">{{ value.name }}</strong>
      <div *ngIf="value.file?.file_id">
        <img
          [src]="apiUrl + '/files/' + value.file?.file_id + '/download'"
          alt="Illustration"
          width="100"
        />
      </div>
    </div>
    <div class="event-buttons">
      <button (click)="startEdit(value)">✏️ Modifier</button>
      <button (click)="deleteValue(value.value_id)">🗑️ Supprimer</button>
    </div>
  </ng-container>

  <!-- Formulaire de modification -->
  <ng-template #editTemplate>
    <form class="create-form" [formGroup]="editForm" (ngSubmit)="saveEdit(value)">
      <!-- Titre -->
      <input type="text" formControlName="name" placeholder="Titre" />
      <div *ngIf="editForm.get('name')?.invalid && editForm.get('name')?.touched" class="error">
        <span *ngIf="editForm.get('name')?.errors?.['required']">Le titre est obligatoire.</span>
        <span *ngIf="editForm.get('name')?.errors?.['maxlength']">Le titre ne doit pas dépasser 20 caractères.</span>
      </div>
  
      <!-- Fichier -->
      <div class="form-buttons">
        <button type="button" (click)="showEditFileSelector = !showEditFileSelector">
          {{ showEditFileSelector ? '❌ Fermer les images' : '📎 Lier une image' }}
        </button>
  
        <div *ngIf="showEditFileSelector">
          <app-file-selector
            [files]="files"
            [selectedFileId]="editForm.value.file_id"
            (fileSelected)="onFileSelect($event)">
          </app-file-selector>
        </div>
  
        <button type="submit" [disabled]="editForm.invalid">💾 Sauvegarder</button>
        <button type="button" (click)="cancelEdit()">❌ Annuler</button>
      </div>
    </form>
  </ng-template>
  
</div>
