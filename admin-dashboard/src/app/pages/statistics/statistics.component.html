<h2>📊 Statistiques</h2>

<!-- Filtre et bouton d'ajout -->
<div class="filter-add-wrapper">
  <select (change)="onTypeFilterChange($event)">
    <option value="">Toutes les statistiques</option>
    <option *ngFor="let type of types" [value]="type.type_id">
      {{ type.name }}
    </option>
  </select>

  <button (click)="showCreate = !showCreate">
    {{ showCreate ? '❌ Annuler' : '➕ Ajouter une statistique' }}
  </button>
</div>

<!-- Formulaire d'ajout -->
<form
  *ngIf="showCreate"
  class="create-form"
  [formGroup]="createForm"
  (ngSubmit)="addStatistic()"
>
  <input formControlName="label" placeholder="Label" />
  <input type="number" formControlName="value" placeholder="Valeur" />
  <input type="number" formControlName="year" placeholder="Année" />
  <select formControlName="type_id">
    <option [value]="null" disabled>Sélectionner un type</option>
    <option *ngFor="let type of types" [value]="type.type_id">
      {{ type.name }}
    </option>
  </select>
  <div class="form-buttons">
    <button type="submit" [disabled]="createForm.invalid">Ajouter</button>
  </div>
</form>

<!-- Liste des statistiques -->
<div *ngFor="let stat of filteredStatistics" class="event-card">
  <div *ngIf="editingId !== stat.statistic_id">
    <div class="event-content">
      <strong class="event-year">{{ stat.label }}</strong>
      <p class="event-description">
        {{ stat.value }} ({{ stat.year }}) - {{ stat.type?.name }}
      </p>
    </div>
    <div class="event-buttons">
      <button (click)="startEdit(stat)">✏️ Modifier</button>
      <button (click)="deleteStatistic(stat.statistic_id)">🗑️ Supprimer</button>
    </div>
  </div>

  <!-- Formulaire d’édition -->
  <form *ngIf="editingId === stat.statistic_id" [formGroup]="editForm" (ngSubmit)="saveEdit(stat)">
    <input formControlName="label" />
    <input type="number" formControlName="value" />
    <input type="number" formControlName="year" />
    <select formControlName="type_id">
      <option *ngFor="let type of types" [value]="type.type_id">
        {{ type.name }}
      </option>
    </select>
    <div class="form-buttons">
      <button type="submit" [disabled]="editForm.invalid">Valider</button>
      <button type="button" (click)="cancelEdit()">Annuler</button>
    </div>
  </form>
</div>
