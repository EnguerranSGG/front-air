<!-- Liste des actualités -->
<div *ngFor="let news of newsList" class="event-card">
    <div class="event-content">
      <strong class="event-year">{{ news.name | sanitize }}</strong>
      <p class="event-description">{{ news.description | sanitize }}</p>
      <div *ngIf="news.file?.file_id">
        <img [src]="apiUrl + '/files/' + news.file?.file_id + '/download'" alt="{{ news.name | sanitize }}" width="100" />
      </div>
    </div>
    <div class="event-buttons">
      <button (click)="openEditModal(news)">✏️ Modifier cette actualité</button>
    </div>
  </div>
  
  <!-- Modal Édition -->
  <div class="modal-overlay" *ngIf="isEditModalOpen">
    <div class="modal">
      <h3>Modifier une actualité</h3>
      <form [formGroup]="editForm">
        
        <!-- Champ Titre -->
        <input formControlName="name" type="text" placeholder="Titre de l'actualité" />
        <div *ngIf="editForm.get('name')?.invalid && editForm.get('name')?.touched" class="error">
          <span *ngIf="editForm.get('name')?.errors?.['required']">Le titre est obligatoire.</span>
          <span *ngIf="editForm.get('name')?.errors?.['maxlength']">Le titre ne doit pas dépasser 100 caractères.</span>
        </div>
  
        <!-- Champ Description -->
        <textarea formControlName="description" placeholder="Contenu de l'actualité"></textarea>
        <div *ngIf="editForm.get('description')?.invalid && editForm.get('description')?.touched" class="error">
          <span *ngIf="editForm.get('description')?.errors?.['required']">La description est obligatoire.</span>
          <span *ngIf="editForm.get('description')?.errors?.['maxlength']">La description ne doit pas dépasser 300 caractères.</span>
        </div>
  
        <!-- Champ Lien (optionnel) -->
        <input formControlName="link" type="url" placeholder="Lien externe (facultatif)" />
        <div *ngIf="editForm.get('link')?.invalid && editForm.get('link')?.touched" class="error">
          <span *ngIf="editForm.get('link')?.errors?.['pattern']">Le lien doit commencer par http:// ou https://</span>
          <span *ngIf="editForm.get('link')?.errors?.['maxlength']">Le lien ne doit pas dépasser 255 caractères.</span>
        </div>
  
        <!-- Sélecteur de fichier -->
        <button type="button" (click)="showEditFileSelector = !showEditFileSelector">
          {{ showEditFileSelector ? '❌ Fermer les images' : '📎 Lier une image' }}
        </button>
  
        <div *ngIf="showEditFileSelector">
          <app-file-selector
            [files]="files"
            [selectedFileId]="editForm.value.file_id"
            (fileSelected)="onFileSelect($event)"
          ></app-file-selector>
        </div>
  
        <div class="form-buttons">
          <button type="button" (click)="saveEdit()" [disabled]="editForm.invalid">💾 Sauvegarder</button>
          <button type="button" (click)="closeEditModal()">❌ Annuler</button>
        </div>
      </form>
    </div>
  </div>
  